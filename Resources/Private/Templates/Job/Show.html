<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers" xmlns:pxa="http://typo3.org/ns/Pixelant/PxaIntelliplanJobs/ViewHelpers" data-namespace-typo3-fluid="true">
<f:layout name="Default" />

<f:section name="main">

    <f:flashMessages />
    <div class="page-header">
        <div class="page-header__logo">
            <f:if condition="{job.companyLogoUrl}">
                <img src="{job.companyLogoUrl}" alt="{job.company}" title="{job.company}">
            </f:if>
        </div>
        <div class="red-preheader">
            <h2 class="page-header__categories">
                <span>{job.company}</span>
                <span>{job.municipality}</span>
            </h2>
        </div>
        <h1>{job.title}</h1>
        <f:comment>
            <f:if condition="{job.pubDateTo}">
                <p><f:translate key="fe.apply_before" /> <f:format.date date="{job.pubDateTo}" format="{settings.dateFormatHeader}"/></p>
            </f:if>
            <div class="text-center text-uppercase">
                <a href="javascript:{}" data-job-scroll="1" data-scroll-fix="-40|-180" data-scroll-to="#pxa-apply-job" class="btn btn-default"><f:translate key="fe.sumit_2" /></a>
            </div>
        </f:comment>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <f:if condition="{job.topImages}">
                    <f:render section="additonalImages" arguments="{job: job, images: job.topImages}" />
                </f:if>
                <f:format.html>{job.description}</f:format.html>
                <f:if condition="{job.bottomImages}">
                    <f:render section="additonalImages" arguments="{job: job, images: job.bottomImages}" />
                </f:if>
            </div>
            <div class="col-md-3">
                <div class="light-gray-background">
                    <div class="side-content">
                        <h3><f:translate key="fe.quick_facts" /></h3>
                        <p><strong><f:translate key="fe.job" /></strong> <br>{job.service}</p>
                        <f:if condition="{job.state}">
                            <p><strong><f:translate key="fe.region" /></strong> <br>{job.state}</p>
                        </f:if>
                        <f:if condition="{job.municipality}">
                            <p><strong><f:translate key="fe.city" /></strong> <br>{job.municipality}</p>
                        </f:if>
                        <f:if condition="{job.employmentExtent}">
                            <p><strong><f:translate key="fe.extent" /></strong> <br>{job.employmentExtent}</p>
                        </f:if>
                        <f:if condition="{job.employmentType}">
                            <p><strong><f:translate key="fe.duration" /></strong> <br>{job.employmentType}</p>
                        </f:if>
                        <f:if condition="{job.start}">
                            <p><strong><f:translate key="fe.start" /></strong> <br>{job.start}</p>
                        </f:if>
                        <f:if condition="{job.pubDateTo}">
                            <p><strong><f:translate key="fe.apply_before" /></strong> <br><f:format.date date="{job.pubDateTo}" format="{settings.dateFormat}"/></p>
                        </f:if>
                    </div>
                </div>

                <f:if condition="{job.contentElementsUids}">
                    <f:cObject typoscriptObjectPath="lib.pxaIntelliplanJobsContentElementsRenderer" data="{uids: job.contentElementsUids}" />
                </f:if>

                <f:if condition="{settings.showShareForm}">
                    <div class="light-gray-background">
                        <div class="side-form">
                            <h3><f:translate key="fe.tell_friend" /></h3>

                            <f:form controller="JobAjax" action="share" pluginName="Pi2" pageType="{settings.sharePageType}" objectName="shareJob" class="pxa-tell-friend">
                                <div class="form-group" data-field="receiverName">
                                    <f:form.textfield class="form-control" placeholder="{f:translate(key: 'fe.friend_name')}" property="receiverName"/>
                                </div>
                                <div class="form-group" data-field="receiverEmail">
                                    <f:form.textfield class="form-control" placeholder="{f:translate(key: 'fe.friend_email')}" property="receiverEmail"/>
                                </div>
                                <div class="form-group" data-field="senderName">
                                    <f:form.textfield class="form-control" placeholder="{f:translate(key: 'fe.your_name')}" property="senderName"/>
                                </div>

                                <button type="submit" class="btn btn-default text-uppercase"><f:translate key="fe.submit" /></button>

                                <f:form.hidden property="shareUrl" value="{shareUrl}" />
                                <f:form.hidden name="job" value="{job}" />
                            </f:form>
                            <!-- '_ready' -->
                            <div class="ajax-loader _ready">
                                <f:render partial="AjaxLoader" />
                            </div>
                        </div>
                    </div>
                </f:if>
            </div>
        </div>
    </div>

    <div class="page-navigation visible-md visible-lg">
        <div class="container">
            <f:cObject typoscriptObjectPath="lib.pxaIntelliplanJobsBreadCrumbs" data="{categoryTitle: job.categoryTypo3.title, categoryUid: 'cat{job.categoryTypo3.uid}'}"/>
        </div>
    </div>

    <div class="light-gray-background" id="pxa-apply-job">
        <div class="container">
            <div class="row">
                <div class="col-md-8 center-block">
                    <div class="panel-box">
                        <div class="form-header text-center">
                            <h2><f:translate key="fe.application" /></h2>
                        </div>

                        <f:form enctype="multipart/form-data" name="apply-job" action="applyJob" controller="JobAjax" pluginName="Pi2" pageType="{settings.sharePageType}">
                            <f:form.hidden name="job" value="{job}" />
                            <f:form.hidden name="requireCV" value="1" />

                            <div class="panel-box__body">
                                <f:render section="applyJobFields" />

                                <f:render section="uploadFile" arguments="{label: 'add_cv', name: 'cv'}"/>
                                <f:render section="uploadFile" arguments="{label: 'add_letter', name: 'letter'}"/>

                                <div id="pxa-additional-file-template" class="hidden" data-label="{f:translate(key:'fe.additional_file')} ###COUNTER###" data-name="file_###COUNTER###">
                                    <f:render section="uploadFile" arguments="{label: 'additional_file', name: 'file_0'}"/>
                                </div>

                                <f:render section="addAdditionalFile" />

                                <div class="form-additions">
                                    <f:render section="agreeOnTerms" />
                                </div>
                            </div>

                            <f:render section="submitButton" />
                        </f:form>
                        <div class="ajax-loader _ready">
                            <f:render partial="AjaxLoader" />
                        </div>
                    </div>


                    <div class="panel-box">
                        <div class="panel-header">
                            <h2><f:translate key="fe.no_cv" /></h2>
                        </div>
                        <f:form enctype="multipart/form-data" class="js__panel-collapsible" name="apply-job" action="applyJob" controller="JobAjax" pluginName="Pi2" pageType="{settings.sharePageType}">
                            <f:form.hidden name="job" value="{job}" />

                            <div class="panel-box__body">
                                <f:render section="applyJobFields" />

                                <f:for each="{settings.applyJob.fields.noCvRadios -> pxa:explode()}" as="checkbox">
                                    <div class="form-additions" data-field="{checkbox}">
                                        <p><strong><f:translate key="fe.checkbox_{checkbox}" /></strong></p>
                                        <f:if condition="{f:translate(key: 'fe.checkbox_{checkbox}_tip')}">
                                            <p><em><f:translate key="fe.checkbox_{checkbox}_tip" /></em></p>
                                        </f:if>
                                        <div class="radio-item">
                                            <label>
                                                <f:form.radio name="applyJob[{checkbox}]" value="{f:translate(key: 'fe.yes')}" />
                                                <span><f:translate key="fe.yes" /></span>
                                            </label>
                                        </div>
                                        <div class="radio-item">
                                            <label>
                                                <f:form.radio name="applyJob[{checkbox}]" value="{f:translate(key: 'fe.no')}" />
                                                <span><f:translate key="fe.no" /></span>
                                            </label>
                                        </div>
                                    </div>
                                </f:for>

                                <div class="form-additions">
                                    <f:render section="agreeOnTerms" />
                                </div>
                            </div>

                            <f:render section="submitButton" />
                        </f:form>
                        <div class="ajax-loader _ready">
                            <f:render partial="AjaxLoader" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="page-navigation visible-md visible-lg">
        <div class="container">
            <f:cObject typoscriptObjectPath="lib.pxaIntelliplanJobsBreadCrumbs" data="{categoryTitle: job.categoryTypo3.title, categoryUid: 'cat{job.categoryTypo3.uid}'}" />
        </div>
    </div>
</f:section>

<f:section name="additonalImages">
    <f:for each="{images}" as="image">
        <f:if condition="{image.originalResource.properties.link}">
            <f:then>
                <f:link.typolink parameter="{image.originalResource.properties.link}">
                    <f:image image="{image}"
                             width="{settings.singleView.image.width}"
                             height="{settings.singleView.image.height}"
                             title="{f:if(condition: image.originalResource.properties.title, then: image.originalResource.properties.title, else: job.title)}"
                             alt="{f:if(condition: image.originalResource.properties.title, then: image.originalResource.properties.title, else: job.title)}"
                    />
                </f:link.typolink>
            </f:then>
            <f:else>
                <f:image image="{image}"
                         width="{settings.singleView.image.width}"
                         height="{settings.singleView.image.height}"
                         title="{f:if(condition: image.originalResource.properties.title, then: image.originalResource.properties.title, else: job.title)}"
                         alt="{f:if(condition: image.originalResource.properties.title, then: image.originalResource.properties.title, else: job.title)}"
                />
            </f:else>
        </f:if>
    </f:for>
</f:section>

<f:section name="uploadFile">
    <div class="form-additions">
        <div class="row">
            <div class="col-sm-6">
                <p class="additions-label">
                    <strong data-file-label="1"><f:translate key="fe.{label}"/></strong>
                </p>
                <span data-field="{name}"></span>
            </div>
            <div class="col-sm-6 _actions">
                <div class="file-uploader">
                    <label class="btn btn-upload">
                        <f:form.upload class="js__file-upload" name="applyJobFiles[{name}]"/>
                        <span>
                            <span class="action-name">
                                <i class="icons icon-paperclip"></i>
                                <f:translate key="fe.attach_document" />
                            </span>
                            <span class="file-uploader__name"></span>
                        </span>
                    </label>
                    <i class="icons icon-clear file-uploader__clear js__file-upload__clear"></i>
                </div>
            </div>
        </div>
    </div>
</f:section>

<f:section name="addAdditionalFile">
    <div class="form-additions">
        <div class="row">
            <div class="col-sm-6">
                <a href="javascript: {}" data-add-document="1">
                    <i class="icons icon-plus"></i>
                    <span><f:translate key="fe.add_documents" /></span>
                </a>
            </div>
            <div class="col-sm-6">
                <p><f:translate key="fe.add_documents_tip" /></p>
            </div>
        </div>
    </div>
</f:section>

<f:section name="agreeOnTerms">
    <div class="form-additions__agreement" data-field="agreement_type">
        <f:form.checkbox value="1" name="applyJob[agreement_type]" class="acceptTerms"/>
        <p>
            <f:translate key="fe.accept_terms_text" arguments="{0: '{f:render(section: \'agreeOnTermsLink\')}'}"/>
        </p>
    </div>
</f:section>

<f:section name="agreeOnTermsLink"><f:spaceless>
    <f:link.typolink parameter="{settings.applyJob.termsLink}" target="_blank">
        <span><f:translate key="fe.accept_term_link" /></span>
    </f:link.typolink>
</f:spaceless></f:section>


<f:section name="applyJobFields">
    <div class="row">
        <f:for each="{settings.applyJob.fields.formFields -> pxa:explode()}" as="field" iteration="i">
            <f:cycle values="{0: '0', 1: '1'}" as="cycle">
                <div class="col-sm-6">
                    <div class="form-item" data-field="{field}">
                        <f:form.textfield
                                class="form-control"
                                placeholder="{f:translate(key: 'placeholder.{field}')}"
                                name="applyJob[{field}]" />
                    </div>
                </div>
                <f:if condition="{cycle}">
                    <f:if condition="{i.isLast}">
                        <f:else><f:render section="closeOpenRow" /></f:else>
                    </f:if>
                </f:if>
            </f:cycle>
        </f:for>
    </div>
</f:section>

<f:section name="submitButton">
    <div class="panel-box__footer" data-field="submit">
        <div class="form-actions text-center">
            <button type="submit" class="btn btn-default text-uppercase" disabled><f:translate key="fe.sumit_2" /></button>
        </div>
    </div>
</f:section>

<f:section name="closeOpenRow"></div><div class="row"></f:section>
</html>